{"pageProps":{"metadata":{"title":"Nomad Jobspec Canary | Integrations","description":"The Nomad Jobspec Canary plugin promotes a Nomad canary deployment initiated by a Nomad jobspec deployment."},"product":{"name":"Waypoint","slug":"waypoint","algoliaConfig":{"indexName":"product_WAYPOINT","searchOnlyApiKey":"5e4adfd8094367056501547d6fedb6c5"},"analyticsConfig":{"includedDomains":"waypointproject.io www.waypointproject.io","segmentWriteKey":"9mlIVayJbNtJW2EOdAFKHNKcdLAgEDlV"},"metadata":{"title":"Waypoint by HashiCorp","description":"Waypoint provides a modern workflow for build, deploy, and release across platforms.","image":"https://www.waypointproject.io/waypoint-public/img/og-image.png","icon":[{"href":"/waypoint-public/_favicon.ico"}]},"alertBannerActive":true,"alertBanner":{"tag":"HashiConf","url":"https://hashiconf.com/2023?utm_source=direct&utm_medium=banner&utm_campaign=23Q3_HASHICONFGLOBAL_EVENT&utm_content=&utm_offer=event","text":"Our community conference is taking place in San Francisco and online October 10-12.","linkText":"Register now","expirationDate":""},"subnavItems":[{"text":"Overview","url":"/","type":"inbound"},{"text":"Tutorials","url":"https://developer.hashicorp.com/waypoint/tutorials","type":"inbound"},{"text":"Docs","url":"https://developer.hashicorp.com/waypoint/docs","type":"inbound"},{"text":"CLI","url":"https://developer.hashicorp.com/waypoint/commands","type":"inbound"},{"text":"Integrations","url":"https://developer.hashicorp.com/waypoint/integrations","type":"inbound"},{"text":"Community","url":"/community","type":"inbound"}],"basePaths":["commands","docs","plugins","tutorials","downloads"],"rootDocsPaths":[{"iconName":"docs","name":"Documentation","path":"docs","includeMDXSource":true},{"iconName":"api","name":"API","path":"api-docs"},{"iconName":"terminal-screen","name":"CLI","path":"commands"}],"integrationsConfig":{"description":"A curated collection of official, partner, and community Waypoint Integrations."}},"integration":{"id":"5771b7ea-29f4-4ed5-a6cd-693eb0ed78b9","slug":"nomad-jobspec-canary","name":"Nomad Jobspec Canary","description":"The Nomad Jobspec Canary plugin promotes a Nomad canary deployment initiated by a Nomad jobspec deployment.","license_type":"MPL-2.0","license_url":"https://github.com/hashicorp/waypoint/blob/main/LICENSE","external_only":false,"external_url":null,"tier":"official","repo_url":"https://github.com/hashicorp/waypoint","subdirectory":"/builtin/nomad/canary","created_at":"2023-02-03T18:34:00.512Z","updated_at":"2023-02-03T18:42:34.099Z","hide_versions":false,"organization":{"id":"a4a0551a-1451-4d89-9f56-8031c8350c77","slug":"hashicorp","created_at":"2022-11-09T22:56:32.391Z","updated_at":"2022-11-09T22:56:32.391Z"},"product":{"id":"68c85272-e2bf-4330-aa43-4ce4e6d899ee","slug":"waypoint","name":"Waypoint","created_at":"2022-11-09T22:56:30.388Z","updated_at":"2022-11-09T22:56:30.388Z"},"versions":["0.11.0"],"components":[{"id":"72a6044a-138c-4b9f-8441-6d9676cd0197","slug":"release-manager","name":"Release Manager","plural_name":"Release Managers"}],"flags":[{"id":"d2a85dd2-1cca-4ce9-8f88-fef3c8dd0510","slug":"builtin","name":"Built-in","description":"This integration is shipped in the core product and does not need to be installed.","created_at":"2022-11-09T22:56:30.770Z","updated_at":"2023-01-27T18:33:54.665Z"}],"integration_type":null},"activeRelease":{"id":"6e9c36c3-cfc3-43e0-958d-d4a2e1c0ca46","integration_id":"5771b7ea-29f4-4ed5-a6cd-693eb0ed78b9","version":"0.11.0","readme":"The Nomad Jobspec Canary plugin promotes a [Nomad](https://www.nomadproject.io/)\ncanary deployment initiated by a Nomad jobspec deployment.\n\n### Components\n\n1. [ReleaseManager](/waypoint/integrations/hashicorp/nomad-jobspec-canary/latest/components/release-manager/nomad-jobspec-canary-release-manager)\n\n### Related Plugins\n\n1. [Nomad Jobspec](/waypoint/integrations/hashicorp/nomad-jobspec)\n\n### Resources\n\n1. Nomad Job\n","created_at":"2023-02-13T19:44:57.257Z","updated_at":"2023-04-04T18:44:29.554Z","components":[{"id":"db930d06-1212-4c9a-b45d-ed34b952d56d","integration_release_id":"6e9c36c3-cfc3-43e0-958d-d4a2e1c0ca46","component_id":"72a6044a-138c-4b9f-8441-6d9676cd0197","readme":"<!-- This file was generated via `make gen/integrations-hcl` -->\nPromotes a Nomad canary deployment initiated by a Nomad jobspec deployment.\n\nIf your Nomad deployment is configured to use canaries, this releaser plugin lets\nyou promote (or fail) the canary deployment. You may also target specific task\ngroups within your job for promotion, if you have multiple task groups in your canary\ndeployment.\n\n-> **Note:** Using the `-prune=false` flag is recommended for this releaser. By default,\nWaypoint prunes and destroys all unreleased deployments and keeps only one previous\ndeployment. Therefore, if `-prune=false` is not set, Waypoint may delete\nyour job via \"pruning\" a previous version. See [deployment pruning](/waypoint/docs/lifecycle/release#deployment-pruning)\nfor more information.\n\n### Release URL\n\nIf you want the URL of the release of your deployment to be published in Waypoint,\nyou must set the meta 'waypoint.hashicorp.com/release_url' in your jobspec. The\nvalue specified in this meta field will be published as the release URL for your\napplication. In the future, this may source from Consul.\n\n### Interface\n\n- Input: **jobspec.Deployment**\n\n### Examples\n\n```hcl\n// The waypoint.hcl file\nrelease {\n  use \"nomad-jobspec-canary\" {\n    groups = [\n      \"app\"\n    ]\n  }\n}\n\n// The app.nomad.tpl file\njob \"web\" {\n  datacenters = [\"dc1\"]\n\n  group \"app\" {\n    network {\n      mode = \"bridge\"\n      port \"http\" {\n        to = 80\n      }\n    }\n\n    // Setting a canary in the update stanza indicates a canary deployment\n    update {\n      max_parallel = 1\n      canary       = 1\n      auto_revert  = true\n      auto_promote = false\n      health_check = \"task_states\"\n    }\n\n    service {\n      name = \"app\"\n      port = 80\n      connect {\n        sidecar_service {}\n      }\n    }\n\n    task \"app\" {\n      driver = \"docker\"\n      config {\n        image = \"${artifact.image}:${artifact.tag}\"\n        ports  = [\"http\"]\n      }\n\n      env {\n        %{ for k,v in entrypoint.env ~}\n        ${k} = \"${v}\"\n        %{ endfor ~}\n\n        // Ensure we set PORT for the URL service. This is only necessary\n        // if we want the URL service to function.\n        PORT = 80\n      }\n    }\n  }\n\n  group \"app-gateway\" {\n    network {\n      mode = \"bridge\"\n      port \"inbound\" {\n        static = 8080\n        to     = 8080\n      }\n    }\n\n    service {\n      name = \"gateway\"\n      port = \"8080\"\n\n      connect {\n        gateway {\n          proxy {}\n\n          ingress {\n            listener {\n              port = 8080\n              protocol = \"http\"\n              service {\n                name  = \"app\"\n                hosts = [ \"*\" ]\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n  meta = {\n    // Ensure we set meta for Waypoint to detect the release URL\n    \"waypoint.hashicorp.com/release_url\" = \"http://app.ingress.dc1.consul:8080\"\n  }\n}\n```\n\n","created_at":"2023-03-14T21:14:04.097Z","updated_at":"2023-03-14T21:14:04.097Z","name":"Nomad Jobspec Canary Release Manager","slug":"nomad-jobspec-canary-release-manager","component":{"id":"72a6044a-138c-4b9f-8441-6d9676cd0197","slug":"release-manager","name":"Release Manager","plural_name":"Release Managers","product_id":"68c85272-e2bf-4330-aa43-4ce4e6d899ee","created_at":"2022-11-09T22:56:31.564Z","updated_at":"2022-11-09T22:56:31.564Z"},"variable_groups":[{"id":"ff5d66de-7ceb-4f39-8878-6c4814f04e3a","created_at":"2023-03-14T21:14:04.805Z","updated_at":"2023-03-14T21:14:04.805Z","integration_release_component_id":"db930d06-1212-4c9a-b45d-ed34b952d56d","variable_group_config":{"id":"263c5c35-8751-466c-aa7a-7f1a76973bd6","product_id":"68c85272-e2bf-4330-aa43-4ce4e6d899ee","name":"Parameters","filename":"parameters.hcl","stanza":"parameter","display_order":1,"created_at":"2022-12-06T21:05:38.246Z","updated_at":"2022-12-06T21:05:38.246Z"},"variables":[{"id":"48b95a5a-2724-4c7a-aa39-87e79df34b7d","variable_group_id":"ff5d66de-7ceb-4f39-8878-6c4814f04e3a","key":"fail_deployment","description":"If true, marks the deployment as failed.","type":"bool","required":false,"default_value":null,"created_at":"2023-03-14T21:14:05.106Z","updated_at":"2023-03-14T21:14:05.106Z"},{"id":"24e063ae-5ee2-4464-ac04-7c9a2fe5682d","variable_group_id":"ff5d66de-7ceb-4f39-8878-6c4814f04e3a","key":"groups","description":"List of task group names which are to be promoted.","type":"list of string","required":false,"default_value":null,"created_at":"2023-03-14T21:14:05.508Z","updated_at":"2023-03-14T21:14:05.508Z"}]}]}]},"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Waypoint","url":"/waypoint"},{"title":"Integrations","url":"/waypoint/integrations"},{"title":"Nomad Jobspec Canary","url":"/waypoint/integrations/hashicorp/nomad-jobspec-canary","isCurrentPage":true}],"anchorLinks":[{"id":"components","level":3,"title":"Components"},{"id":"related-plugins","level":3,"title":"Related Plugins"},{"id":"resources","level":3,"title":"Resources"}],"serializedREADME":{"compiledSource":"var m=Object.defineProperty,d=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var s=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var r=(e,a,o)=>a in e?m(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o,n=(e,a)=>{for(var o in a||(a={}))p.call(a,o)&&r(e,o,a[o]);if(s)for(var o of s(a))l.call(a,o)&&r(e,o,a[o]);return e},i=(e,a)=>d(e,y(a));var c=(e,a)=>{var o={};for(var t in e)p.call(e,t)&&a.indexOf(t)<0&&(o[t]=e[t]);if(e!=null&&s)for(var t of s(e))a.indexOf(t)<0&&l.call(e,t)&&(o[t]=e[t]);return o};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(o){var t=o,{components:e}=t,a=c(t,[\"components\"]);return mdx(MDXLayout,i(n(n({},layoutProps),a),{components:e,mdxType:\"MDXLayout\"}),mdx(\"p\",n({},{className:\"g-type-long-body\"}),\"The Nomad Jobspec Canary plugin promotes a \",mdx(\"a\",n({parentName:\"p\"},{href:\"https://www.nomadproject.io/\"}),\"Nomad\"),`\ncanary deployment initiated by a Nomad jobspec deployment.`),mdx(\"h3\",n({},{id:\"user-content-components\",\"data-text-content\":\"Components\",className:\"g-type-display-4\"}),\"Components\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",n({parentName:\"li\"},{href:\"/waypoint/integrations/hashicorp/nomad-jobspec-canary/latest/components/release-manager/nomad-jobspec-canary-release-manager\"}),\"ReleaseManager\"))),mdx(\"h3\",n({},{id:\"user-content-related-plugins\",\"data-text-content\":\"Related Plugins\",className:\"g-type-display-4\"}),\"Related Plugins\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",n({parentName:\"li\"},{href:\"/waypoint/integrations/hashicorp/nomad-jobspec\"}),\"Nomad Jobspec\"))),mdx(\"h3\",n({},{id:\"user-content-resources\",\"data-text-content\":\"Resources\",className:\"g-type-display-4\"}),\"Resources\"),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},\"Nomad Job\")))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"__N_SSG":true}